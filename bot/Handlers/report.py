import math
from docxtpl import DocxTemplate
from telegram import (
    Update, InlineKeyboardButton, InlineKeyboardMarkup,
)
from telegram.ext import (
    ConversationHandler, ContextTypes, CallbackContext
)

from bot.config import ADMIN_IDS


async def start(update: Update, context: CallbackContext):
    """
    –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ /start.
    """
    if is_admin(update):
        txt = (
            f"üîπ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {update.effective_user.first_name}!</b> üëã\n\n"
            "–í—ã –≤–æ—à–ª–∏ –≤ <b>HR-–ø–∞–Ω–µ–ª—å –ú–†–°–ö –ß–µ–ª—è–±–≠–Ω–µ—Ä–≥–æ</b>\n\n"
            "‚ö° <b>–í–∞—à–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</b>\n"
            "‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏\n"
            "‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–Ω–∫–µ—Ç —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π\n"
            "‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º\n"
            "‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\n\n"
            "–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥: /help\n\n"
            "<i>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /vacancies –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π</i>"
        )
    else:
        txt = (
            f"üîπ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {update.effective_user.first_name}!</b> üëã\n\n"
            "–Ø ‚Äî HR-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç <b>–ú–†–°–ö –ß–µ–ª—è–±–≠–Ω–µ—Ä–≥–æ</b>, –≤–∞—à –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–∏—Ä–µ –∫–∞—Ä—å–µ—Ä–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π!\n\n"
            "‚ö° <i>–≠–Ω–µ—Ä–≥–∏—è –≤–∞—à–µ–π –∫–∞—Ä—å–µ—Ä—ã –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å!</i>\n\n"
            "‚ú® <b>–ß—Ç–æ —è –º–æ–≥—É –¥–ª—è –≤–∞—Å —Å–¥–µ–ª–∞—Ç—å:</b>\n"
            "‚Ä¢ –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏\n"
            "‚Ä¢ –ü–æ–º–æ—á—å –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é –¥–æ–ª–∂–Ω–æ—Å—Ç—å\n"
            "‚Ä¢ –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∏ —É—Å–ª–æ–≤–∏—è—Ö —Ä–∞–±–æ—Ç—ã\n"
            "‚Ä¢ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã\n\n"
            "–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help\n\n"
            "<i>–î–∞–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —ç–Ω–µ—Ä–≥–∏—é –±—É–¥—É—â–µ–≥–æ!</i> ‚ö°"
        )
    greeting = txt
    await update.message.reply_text(
        text=greeting,
        parse_mode='HTML'
    )


async def help(update: Update, ctx: ContextTypes.DEFAULT_TYPE) -> None:
    if is_admin(update):
        header = "üõ† <b>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b> (HR-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç)\n\n"
        cmds = [
            ("/vacancies", "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –≤–∞–∫–∞–Ω—Å–∏–π"),
            ("/vacancy_add", "‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é"),
            ("/vacancy_del", "üóë –£–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é"),
            ("/comment id", "üìù –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É –∫ –∞–Ω–∫–µ—Ç–µ"),
            ("/export_students", "üìä –≠–∫—Å–ø–æ—Ä—Ç –∞–Ω–∫–µ—Ç –≤ Excel"),
            ("/help", "‚ÑπÔ∏è –≠—Ç–æ –º–µ–Ω—é –ø–æ–º–æ—â–∏"),
            ("/cancel", "‚ùå –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"),
        ]
    else:
        header = "üîπ <b>–ú–µ–Ω—é –ø–æ–º–æ—â–Ω–∏–∫–∞ –ø–æ –∫–∞—Ä—å–µ—Ä–µ –≤ –ú–†–°–ö –ß–µ–ª—è–±–≠–Ω–µ—Ä–≥–æ</b>\n\n"
        cmds = [
            ("/start", "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"),
            ("/vacancies", "üîé –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏"),
            ("/apply", "üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é"),
            ("/help", "‚ÑπÔ∏è –≠—Ç–æ –º–µ–Ω—é –ø–æ–º–æ—â–∏"),
            ("/cancel", "‚ùå –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"),
        ]

    text = (
            header +
            "‚ö° <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n\n" +
            "\n".join(f"‚Ä¢ <code>{c}</code> ‚Äî {d}" for c, d in cmds) +
            "\n\n<i>–î–ª—è —Å–≤—è–∑–∏ —Å HR-–æ—Ç–¥–µ–ª–æ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–π</i>"
    )

    await update.message.reply_text(
        text=text,
        parse_mode='HTML'
    )

async def cancel(update: Update, ctx: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ.")
    return ConversationHandler.END

def is_admin(update) -> bool:
    user = update.effective_user
    return bool(user and user.id in ADMIN_IDS)
